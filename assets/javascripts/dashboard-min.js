var graphs=[];var datum=[];var aliases=[];var descriptions=[];var realMetrics=[];var period=(typeof period=="undefined")?5:period;var originalPeriod=period;function gatherRealMetrics(){var b=0;for(var a=0;a<metrics.length;a++){if(metrics[a].target===false){b++}else{if(metrics[a].target.match(/^<object/)){b++}else{realMetrics[a-b]=metrics[a]}}}}function constructGraphs(){for(var a=0;a<realMetrics.length;a++){aliases[a]=realMetrics[a].alias||realMetrics[a].target;descriptions[a]=realMetrics[a].description||null;datum[a]=[{x:0,y:0}];graphs[a]=new Rickshaw.Graph({element:document.querySelector(".graph"+a),width:297,height:105,interpolation:"basis",series:[{name:aliases[a],color:"#b5d9ff",data:datum[a]}]});graphs[a].render()}}var myUrl;var padnulls=(typeof padnulls=="undefined")?true:padnulls;function constructUrl(c){var a="";for(var b=0;b<realMetrics.length;b++){if(b!=0){a+="&"}if(padnulls===true){a+=("target=keepLastValue("+encodeURI(realMetrics[b].target)+")")}else{a+=("target="+encodeURI(realMetrics[b].target))}}myUrl=url+"/render?"+a+"&from=-"+c+"minutes&format=json"}function refreshData(a){getData(function(c){for(var f=0;f<graphs.length;f++){for(var e=0;e<c[f].length;e++){if(typeof c[f][e]!=="undefined"){datum[f][e]=c[f][e]}}var d=datum[f][datum[f].length-1].y;var g=realMetrics[f].warning;var h=realMetrics[f].critical;if(h>g){if(d>=h){graphs[f].series[0].color="#d59295"}else{if(d>=g){graphs[f].series[0].color="#f5cb56"}else{graphs[f].series[0].color="#afdab1"}}}else{if(d<=h){graphs[f].series[0].color="#d59295"}else{if(d<=g){graphs[f].series[0].color="#f5cb56"}else{graphs[f].series[0].color="#b5d9ff"}}}if(a){updateGraphs(f)}}c=null});if(!a){for(var b=0;b<graphs.length;b++){updateGraphs(b)}}}function getDashboards(a){$.ajax({dataType:"json",error:function(c,d,b){console.log(b)},url:"/"}).done(function(b){a(b.dashboards)})}function getData(a){var b=[];$.ajax({dataType:"json",error:function(d,e,c){console.log(c)},url:myUrl}).done(function(f){if(f.length>0){for(var e=0;e<f.length;e++){b[e]=[];for(var c=0;c<f[e].datapoints.length;c++){b[e][c]={x:f[e].datapoints[c][1],y:f[e].datapoints[c][0]}}}}a(b)})}function updateGraphs(d){graphs[d].update();if(datum[d][datum[d].length-1]!==undefined){var c=0;for(var b=0;b<datum[d].length;b++){c=c+datum[d][b].y}c=c/datum[d].length;var a;if((typeof c=="number")&&c<10){a=Math.round(c*100)/100}else{a=Math.round(c)}$(".overlay-name"+d).text(aliases[d]);$(".overlay-number"+d).text(a)}else{$(".overlay-name"+d).text(aliases[d]);$(".overlay-number"+d).html('<span class="error">NF</span>')}}function buildContainers(){var c=0;for(var b=0;b<metrics.length;b++){if(metrics[b].target===false){$(".main").append('<div class="false"></div>');c++}else{if(metrics[b].target.match(/^<object/)){$(".main").append('<div class="false">'+metrics[b].target+"</div>");c++}else{var a=b-c;$(".main").append('<div id="'+a+'" class="graph graph'+a+'"><div class="overlay-name overlay-name'+a+'"></div><div class="overlay-number overlay-number'+a+'"></div></div>')}}}}gatherRealMetrics();buildContainers();constructGraphs();constructUrl(period);var toolbar=(typeof toolbar=="undefined")?true:toolbar;if(!toolbar){$("div.toolbar").css("display","none")}for(var i=0;i<graphs.length;i++){if(realMetrics[i].target===false){$(".overlay-number"+i).html('<img src="images/spin.gif" />')}}refreshData("now");var refreshInterval=(typeof refresh=="undefined")?2000:refresh;var refreshId=setInterval(refreshData,refreshInterval);